app-id: io.github.lact-linux
runtime: org.gnome.Platform
runtime-version: "48"
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  - org.freedesktop.Sdk.Extension.llvm20
command: startup.sh
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=/run/lactd.sock
modules:
  - name: lact
    buildsystem: simple 
    sources:
      - generated-sources.json
      - type: dir
        path: "../"
        skip: 
          - "target"
          - "target_ra"
    build-commands:
      - cargo --offline fetch --manifest-path Cargo.toml
      # - cargo --offline build -p lact --features flatpak --release
      - cargo --offline build -p lact --features flatpak
      - PREFIX=/app make install-debug
      - install -Dm755 flatpak/startup.sh /app/bin/startup.sh
    build-options:
      append-path: "/usr/lib/sdk/rust-stable/bin:/usr/lib/sdk/llvm20/bin"
      prepend-ld-library-path: "/usr/lib/sdk/llvm20/lib"
      env:
        CARGO_HOME: "/run/build/lact/cargo"
    modules:
      - modules/yad.yaml
      - modules/vulkan-tools.yaml
      - modules/libdrm.yaml
